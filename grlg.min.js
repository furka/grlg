!function(){"use strict";function a(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function b(a){return a=Number(a)||0,a=Math.max(0,a),a=Math.min(1,a)}function c(a,b,c,d){var e,f=[];d=parseInt(d,10)||Math.floor(4*Math.random());for(var g=0,h=j.length;h>g;g+=1)e=(g+d)%h,"undefined"==typeof a.get(b+j[e].x,c+j[e].y)&&f.push(e);return f}function d(a){return a._activeIndexes.splice(Math.floor(Math.random()*a._activeIndexes.length),1)[0]}function e(a,b,c,d){for(var f=!0,h=0;h<b.speed;h+=1)f=f&&g(a,b.min,b.max,b.density,b.linearity);f?setTimeout(e.bind(null,a,b,c,d,!0),10):"function"==typeof c&&c(a),"function"==typeof d&&d(a)}function f(a){for(var b,d,e,f=a._history.length-1;f>=0;f-=1)if(e=a._history[f],b=e%a.width,d=Math.floor(e/a.height),b>0&&b<a.width-1&&d>0&&d<a.height-1&&c(a,b,d).length)return a._cells[e]=!0,a._activeIndexes.push(e),console.log("breaking through",b,d),e}function g(b,e,g,k,l){var m=b.openCount<e,n=g&&b.openCount>=g;if(!b._activeIndexes.length){if(!m)return!1;f(b)}var o,p=d(b),q=p%b.width,r=Math.floor(p/b.height),s=b._propagationDirections[p];Math.random()>l&&(s=void 0);var t,u=c(b,q,r,s);for(o=u.length-1;o>=0;o-=1)t=j[u[o]],(t.x+q<=0||t.x+q>=b.width-1||t.y+r<=0||t.y+r>=b.height-1)&&(i(b,t.x+q,t.y+r,u[o]),u.splice(o,1));if(!u.length)return!0;for(m&&(t=j[u[0]],h(b,t.x+q,t.y+r,u[0]),u.splice(0,1)),u=a(u),o=u.length-1;o>=0;o-=1)t=j[u[o]],!n&&Math.random()<=k?h(b,t.x+q,t.y+r,u[o]):i(b,t.x+q,t.y+r,u[o]);return!0}function h(a,b,c,d){a.openCount+=1;var e=b+c*a.width;return a._cells[e]=!0,a._propagationDirections[e]=d,a._activeIndexes.push(e),a._history.push(e),a.last=e,e}function i(a,b,c,d){var e=b+c*a.width;return a._cells[e]=!1,a._propagationDirections[e]=d,a._history.push(e),e}var j=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}],k=function(a,b){a=Math.floor(a||0),b=Math.floor(b||0),this.width=a,this.height=b,this._cells=[],this._history=[],this._activeIndexes=[],this._propagationDirections=[]};k.prototype.get=function(a,b){return a=Math.floor(a),b=Math.floor(b),this._cells[a+b*this.width]},k.prototype.generate=function(a,c,d){a=a||{},a.density=b(a.density),a.linearity=b(a.linearity),a.speed=parseInt(a.speed,10)||1,a.min=parseInt(a.min,10)||20,a.max=parseInt(a.max,10),a.max=Math.max(a.min,a.max),this._activeIndexes.length=this._cells.length=0,this.openCount=0,this.first=h(this,this.width/2,this.height/2),e(this,a,c,d)},k.prototype.print=function(a,b){b=b||document.createElement("canvas");var c,d,e=b.getContext("2d");a=a||5,b.width=this.width*a,b.height=this.height*a,e.strokeStyle="rgba(200,200,200,1)";for(var f=0;f<this._cells.length;f+=1)"undefined"!=typeof this._cells[f]&&(c=f%this.width,d=Math.floor(f/this.height),f===this.first?e.fillStyle="rgba(0,255,255,1)":f===this.last?e.fillStyle="rgba(255,0,255,1)":this._cells[f]?e.fillStyle="rgba(255,255,255,1)":e.fillStyle="rgba(50,50,50,1)",e.fillRect(c*a,d*a,a,a),a>3&&e.strokeRect(c*a+.5,d*a+.5,a,a));return b},define([],function(){return k})}();